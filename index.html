<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drip's Message Board</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
    <h1>ğŸ¦Š Meet Drip</h1>
    <div class="story">
        <p>ğŸï¸ I used to play on a Minecraft server with my classmates. I had a base made of floating islands â€” a large one in the center, with smaller, less important ones surrounding it.</p>
        <p>ğŸ’§ The only way to reach them was a single stream of water that ran all the way down to the ground.<br>
            ğŸš¶â€â™‚ï¸ As you can imagine, it was hard to bring mobs up there, and I felt kind of lonely.<br>
            ğŸ¦Š I decided to bring up a companion â€” I found a fox holding an emerald and jokingly named him Drip.<br>
            ğŸ“¤ I brought him up the water stream and started building a dedicated island just for him.</p>

        <p>Sadly, the bridges connecting the islands werenâ€™t very safe, and Drip fell off to his death.</p>

        <p>ğŸŒ¼ The island I had built for him became a graveyard, with only his tombstone on it.<br>
            ğŸ’ I placed his emerald on the grave, along with a book where everyone wrote a message to Drip.<br>
            ğŸŒŸ Drip had been the mascot of the server for its entire life â€” losing him was a big moment.</p>

        <p>ğŸ‘¤ To honor him, I took on his name, so he would never be forgotten.<br>
            ğŸ’¬ I changed my Discord name to Drip, and it has stayed that way ever since.</p>

        <p>ğŸŒˆ Drip lives on, enjoying paradise.</p>

        <p>Drip loves you and wants to be remembered.<br>
        Send Drip a message of love, keep his soul alive.</p>

        <p>To share your own message, scan this QR Code</p>
        <img src="./Images/FormQRCODE.png" alt="QRCode">
    </div>
    <p>Messages submitted from the community</p>
</header>

<!-- Filters -->
<section class="filters">
    <input type="text" id="usernameFilter" placeholder="Filter by username">
    <input type="date" id="fromDate">
    <input type="date" id="toDate">
    <button id="applyFilters">Apply</button>
    <button id="resetFilters" class="secondary">Reset</button>
</section>

<!-- Messages container -->
<main id="messageList"></main>

<footer>
    <p>Powered by JSON + GitHub Pages</p>
</footer>

<script>
    let messages = [];

    async function loadMessages() {
      try {
        const response = await fetch('messages.json');
        messages = await response.json();
        renderMessages(messages);
      } catch (err) {
        document.getElementById('messageList').innerHTML =
          "<p class='error'>Could not load messages.json</p>";
      }
    }

    function renderMessages(list) {
      const container = document.getElementById('messageList');
      container.innerHTML = '';

      if (list.length === 0) {
        container.innerHTML = '<p class="empty">No messages found.</p>';
        return;
      }

      // Sort newest first
      list.sort((a, b) => new Date(b.date) - new Date(a.date));

      list.forEach(msg => {
        const card = document.createElement('article');
        card.className = 'message';
        card.innerHTML = `
          <div class="message-header">
            <h3>${msg.username}</h3>
            <span class="date">${msg.date}</span>
          </div>
          <p>${msg.message}</p>
          ${msg.image ? `<img src="${msg.image}" alt="Image from ${msg.username}">` : ''}
        `;
        container.appendChild(card);
      });
    }

    function applyFilters() {
      const user = document.getElementById('usernameFilter').value.toLowerCase();
      const from = document.getElementById('fromDate').value;
      const to = document.getElementById('toDate').value;

      const filtered = messages.filter(m => {
        const usernameMatch = !user || m.username.toLowerCase().includes(user);
        const date = m.date;
        const afterFrom = !from || date >= from;
        const beforeTo = !to || date <= to;
        return usernameMatch && afterFrom && beforeTo;
      });

      renderMessages(filtered);
    }

    document.getElementById('applyFilters').addEventListener('click', applyFilters);
    document.getElementById('resetFilters').addEventListener('click', () => {
      document.getElementById('usernameFilter').value = '';
      document.getElementById('fromDate').value = '';
      document.getElementById('toDate').value = '';
      renderMessages(messages);
    });

    loadMessages();
</script>
</body>
</html>
